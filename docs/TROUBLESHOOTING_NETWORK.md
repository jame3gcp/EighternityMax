# 네트워크 접근 문제 해결 가이드

## 현재 상태 확인

✅ 환경 변수 변경 완료: `VITE_API_URL=http://172.30.29.44:3001`
✅ Vite 설정 변경 완료: `host: '0.0.0.0'`
✅ 백엔드 설정 변경 완료: `0.0.0.0` 바인딩

## 필수 단계: 서버 재시작

**중요**: Vite는 환경 변수를 서버 시작 시에만 읽습니다. 
환경 변수를 변경했다면 반드시 서버를 재시작해야 합니다.

### 1. 기존 서버 종료

터미널에서 실행 중인 서버를 종료하세요:

```bash
# 프론트엔드 서버 종료 (Ctrl+C 또는)
kill $(lsof -ti:5173)

# 백엔드 서버 종료 (Ctrl+C 또는)
kill $(lsof -ti:3001)
```

### 2. 서버 재시작

**터미널 1 - 백엔드:**
```bash
cd backend
npm run dev
```

**터미널 2 - 프론트엔드:**
```bash
cd frontend
npm run dev
```

### 3. 서버 로그 확인

프론트엔드 서버를 시작하면 다음과 같은 메시지가 보여야 합니다:

```
  VITE v5.0.8  ready in XXX ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://172.30.29.44:5173/    ← 이 줄이 중요!
```

**"Network" 줄이 보이지 않으면** 서버가 여전히 localhost에만 바인딩된 것입니다.

## 문제 해결 체크리스트

### ✅ 1. 서버 재시작 확인
- [ ] 프론트엔드 서버를 완전히 종료하고 재시작했는가?
- [ ] 백엔드 서버를 완전히 종료하고 재시작했는가?
- [ ] 서버 로그에 "Network: http://172.30.29.44:5173/" 메시지가 보이는가?

### ✅ 2. IP 주소 확인
현재 IP 주소가 172.30.29.44가 맞는지 확인:

```bash
# Wi-Fi IP 확인
ipconfig getifaddr en0

# 또는 모든 네트워크 인터페이스 확인
ifconfig | grep "inet " | grep -v "127.0.0.1"
```

IP 주소가 다르다면 `.env.development` 파일의 IP를 수정하세요.

### ✅ 3. 방화벽 확인

macOS 방화벽이 포트를 차단하고 있을 수 있습니다.

**방법 1: 방화벽 상태 확인**
```bash
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
```

**방법 2: 방화벽에서 포트 허용**
시스템 설정 > 네트워크 > 방화벽 > 옵션에서:
- "들어오는 연결 차단" 해제
- 또는 특정 앱 허용: Node.js, 터미널 추가

**방법 3: 임시로 방화벽 비활성화 (개발용)**
시스템 설정 > 네트워크 > 방화벽에서 방화벽 끄기

### ✅ 4. 네트워크 연결 확인

**같은 네트워크인지 확인:**
- 두 기기가 같은 Wi-Fi 네트워크에 연결되어 있는지 확인
- 공용 Wi-Fi나 게스트 네트워크는 기기 간 통신이 차단될 수 있음

**테스트:**
같은 네트워크의 다른 기기에서:
```bash
# ping 테스트
ping 172.30.29.44

# 포트 접근 테스트
curl http://172.30.29.44:5173
```

### ✅ 5. Vite 설정 재확인

`frontend/vite.config.ts` 파일이 올바르게 저장되었는지 확인:

```typescript
server: {
  host: '0.0.0.0',  // 이 줄이 있어야 함
  port: 5173,
}
```

### ✅ 6. 백엔드 CORS 확인

백엔드 서버의 CORS 설정이 이미 `origin: true`로 되어 있어 
모든 origin을 허용합니다. 추가 설정 불필요.

## 추가 디버깅

### 로컬에서 접근 테스트

같은 컴퓨터에서 IP 주소로 접근해보세요:

```bash
# 브라우저에서
http://172.30.29.44:5173

# 또는 curl로 테스트
curl http://172.30.29.44:5173
```

이것도 안 되면 서버가 제대로 바인딩되지 않은 것입니다.

### 서버 프로세스 확인

```bash
# 어떤 주소로 바인딩되었는지 확인
lsof -i :5173
lsof -i :3001
```

출력에서 `*:5173` 또는 `0.0.0.0:5173`이 보여야 합니다.
`127.0.0.1:5173`만 보이면 설정이 적용되지 않은 것입니다.

## 빠른 해결 방법

1. **모든 서버 완전 종료**
   ```bash
   kill $(lsof -ti:5173) 2>/dev/null
   kill $(lsof -ti:3001) 2>/dev/null
   ```

2. **프론트엔드 재시작 (새 터미널)**
   ```bash
   cd frontend
   npm run dev
   ```
   → "Network: http://172.30.29.44:5173/" 메시지 확인

3. **백엔드 재시작 (새 터미널)**
   ```bash
   cd backend
   npm run dev
   ```

4. **방화벽 임시 비활성화** (테스트용)
   시스템 설정 > 네트워크 > 방화벽 끄기

5. **다른 기기에서 접근 테스트**
   `http://172.30.29.44:5173`

## 여전히 안 되면

1. **IP 주소 재확인**: `ipconfig getifaddr en0`
2. **다른 포트 시도**: Vite 설정에서 포트 변경 (예: 5174)
3. **방화벽 로그 확인**: 차단된 연결이 있는지 확인
4. **네트워크 관리자 확인**: 회사/학교 네트워크는 기기 간 통신이 차단될 수 있음

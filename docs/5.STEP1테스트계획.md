# STEP 1 테스트 계획 (Go-Live 최소 가치)

## 목적
STEP 1에서 구현된 핵심 기능들이 정상적으로 동작하는지 검증하여, "로그인 → 분석 생성 → 오늘 정보 확인" 플로우가 완전히 작동하는지 확인합니다.

---

## 테스트 범위

### 포함된 기능
1. ✅ OAuth 로그인 (Kakao/Google)
2. ✅ 프로필 저장 (생년월일, 출생시간, 성별, 지역)
3. ✅ AI 분석 생성 (비동기 작업)
4. ✅ Life Profile 조회
5. ✅ 데일리 가이드 조회
6. ✅ Home 페이지 (Energy Index, 가이드 요약)
7. ✅ DailyGuide 페이지 (상세 가이드)

### 제외된 기능
- STEP 2 이후 기능들 (기록, 예보, 사이클 차트 등)

---

## 테스트 환경

### 백엔드
- URL: `http://localhost:3001`
- API Base: `/v1`
- 데이터 저장: JSON 파일 기반 (mock-data/data.json)

### 프론트엔드
- URL: `http://localhost:5173`
- 환경 변수: `VITE_API_URL=http://localhost:3001`

### 테스트 계정
- OAuth Provider: 목업 모드 (실제 Provider 연동 전)
- 테스트 사용자: 자동 생성

---

## 1. 단위 테스트 (Unit Tests)

### 1.1 백엔드 API 핸들러

#### OAuth 인증
```javascript
// 테스트 케이스
- [ ] POST /v1/auth/oauth/kakao/callback - 정상 요청
- [ ] POST /v1/auth/oauth/kakao/callback - code 누락 시 400 에러
- [ ] POST /v1/auth/oauth/kakao/callback - 새 사용자 생성 확인
- [ ] POST /v1/auth/oauth/kakao/callback - 기존 사용자 재로그인 확인
- [ ] POST /v1/auth/oauth/google/callback - 정상 요청
```

#### 토큰 관리
```javascript
// 테스트 케이스
- [ ] POST /v1/auth/token/refresh - 정상 갱신
- [ ] POST /v1/auth/token/refresh - 만료된 토큰 시 401 에러
- [ ] POST /v1/auth/token/refresh - 잘못된 토큰 시 401 에러
- [ ] POST /v1/auth/logout - 정상 로그아웃
- [ ] POST /v1/auth/logout - refresh token 삭제 확인
```

#### 프로필 저장
```javascript
// 테스트 케이스
- [ ] POST /v1/users/me/profile - 정상 저장
- [ ] POST /v1/users/me/profile - birth_date 누락 시 400 에러
- [ ] POST /v1/users/me/profile - gender 누락 시 400 에러
- [ ] POST /v1/users/me/profile - 인증 토큰 없을 시 401 에러
- [ ] POST /v1/users/me/profile - 프로필 업데이트 확인
```

#### AI 분석 생성
```javascript
// 테스트 케이스
- [ ] POST /v1/users/me/life-profile/generate - 정상 Job 생성
- [ ] POST /v1/users/me/life-profile/generate - 프로필 없을 시 404 에러
- [ ] GET /v1/jobs/{jobId} - Job 상태 조회 (queued → running → done)
- [ ] GET /v1/jobs/{jobId} - 진행률 업데이트 확인
- [ ] GET /v1/jobs/{jobId} - 존재하지 않는 Job 시 404 에러
```

#### Life Profile 조회
```javascript
// 테스트 케이스
- [ ] GET /v1/users/me/life-profile - 정상 조회
- [ ] GET /v1/users/me/life-profile - 프로필 없을 시 404 에러
- [ ] GET /v1/users/me/life-profile - 인증 토큰 없을 시 401 에러
```

#### 데일리 가이드
```javascript
// 테스트 케이스
- [ ] GET /v1/users/me/daily-guide - 오늘 가이드 조회
- [ ] GET /v1/users/me/daily-guide?date=2026-01-20 - 특정 날짜 조회
- [ ] GET /v1/users/me/daily-guide - Life Profile 없을 시 404 에러
- [ ] GET /v1/users/me/daily-guide - 응답 데이터 구조 확인
```

### 1.2 프론트엔드 컴포넌트

#### Login 페이지
```typescript
// 테스트 케이스
- [ ] OAuth 버튼 클릭 시 콜백 처리
- [ ] URL 파라미터(code, provider) 파싱
- [ ] 로그인 성공 시 토큰 저장 확인
- [ ] next_step에 따른 라우팅 (profile_required → /onboarding)
- [ ] 로그인 실패 시 에러 메시지 표시
```

#### Onboarding 페이지
```typescript
// 테스트 케이스
- [ ] 폼 유효성 검사 (생년월일 필수)
- [ ] 프로필 저장 API 호출
- [ ] AI 분석 생성 API 호출
- [ ] Job 상태 polling (1초 간격)
- [ ] 분석 완료 시 Life Profile 표시
- [ ] 에러 발생 시 사용자 안내
```

#### Home 페이지
```typescript
// 테스트 케이스
- [ ] Daily Guide API 호출
- [ ] Energy Index 표시
- [ ] 가이드 요약 문장 표시
- [ ] 사이클 데이터 로드
- [ ] 로딩 상태 표시
- [ ] 에러 상태 처리
```

#### DailyGuide 페이지
```typescript
// 테스트 케이스
- [ ] 날짜 선택 시 가이드 재조회
- [ ] phase_tag 표시
- [ ] energy_index 표시
- [ ] do/avoid 리스트 표시
- [ ] relationships 텍스트 표시
- [ ] 로딩 상태 표시
```

#### API 클라이언트
```typescript
// 테스트 케이스
- [ ] 토큰 자동 헤더 추가
- [ ] 401 에러 시 자동 토큰 갱신
- [ ] 토큰 갱신 실패 시 로그인 페이지 리다이렉트
- [ ] refresh token rotation 처리
```

---

## 2. 통합 테스트 (Integration Tests)

### 2.1 E2E 사용자 플로우

#### 플로우 1: 신규 사용자 가입 → 분석 생성 → Home 진입
```
1. [ ] /login 페이지 접속
2. [ ] Kakao 로그인 버튼 클릭
3. [ ] OAuth 콜백 처리 (목업)
4. [ ] /onboarding 페이지로 리다이렉트
5. [ ] 생년월일 입력 (예: 1990-01-01)
6. [ ] 출생시간 입력 (예: 14:30)
7. [ ] 성별 선택 (남성)
8. [ ] 지역 입력 (서울시 강남구)
9. [ ] "내 에너지 분석 시작" 버튼 클릭
10. [ ] 분석 생성 로딩 화면 표시
11. [ ] Job 상태 polling (queued → running → done)
12. [ ] 분석 완료 화면 표시 (Energy Type, 강점)
13. [ ] "대시보드로 이동" 버튼 클릭
14. [ ] / 페이지 (Home) 진입
15. [ ] Energy Index 표시 확인
16. [ ] 가이드 요약 문장 표시 확인
17. [ ] 사이클 미니 뷰 표시 확인
```

#### 플로우 2: 기존 사용자 로그인 → Home 진입
```
1. [ ] /login 페이지 접속
2. [ ] Google 로그인 버튼 클릭
3. [ ] OAuth 콜백 처리 (기존 사용자)
4. [ ] / 페이지로 리다이렉트 (next_step: ready)
5. [ ] Home 페이지 로드
6. [ ] Daily Guide 자동 로드 확인
7. [ ] Energy Index 표시 확인
```

#### 플로우 3: 데일리 가이드 조회
```
1. [ ] 로그인 상태에서 /daily-guide 접속
2. [ ] 오늘 날짜 가이드 자동 로드
3. [ ] phase_tag, energy_index 표시 확인
4. [ ] do/avoid 리스트 확인
5. [ ] 날짜 변경 (예: 2026-01-20)
6. [ ] 해당 날짜 가이드 재조회 확인
```

### 2.2 API 통합 테스트

#### 인증 플로우
```
1. [ ] OAuth 콜백 → 토큰 발급
2. [ ] access_token으로 API 호출
3. [ ] 토큰 만료 시 자동 갱신
4. [ ] 로그아웃 후 토큰 무효화 확인
```

#### 프로필 → 분석 → 가이드 플로우
```
1. [ ] 프로필 저장
2. [ ] AI 분석 생성 (Job 생성)
3. [ ] Job 상태 조회 (진행률 확인)
4. [ ] 분석 완료 후 Life Profile 조회
5. [ ] Daily Guide 조회 (Life Profile 기반)
```

---

## 3. 기능 테스트 (Functional Tests)

### 3.1 OAuth 인증
- [ ] **Kakao 로그인**
  - 로그인 버튼 클릭 시 콜백 처리
  - 신규 사용자 자동 가입
  - 기존 사용자 재로그인
  - 토큰 발급 및 저장

- [ ] **Google 로그인**
  - 로그인 버튼 클릭 시 콜백 처리
  - 신규 사용자 자동 가입
  - 기존 사용자 재로그인
  - 토큰 발급 및 저장

- [ ] **토큰 관리**
  - access_token 만료 시 자동 갱신
  - refresh_token rotation
  - 로그아웃 시 토큰 삭제
  - httpOnly cookie 설정 확인

### 3.2 프로필 관리
- [ ] **프로필 저장**
  - 필수 필드 검증 (birth_date, gender)
  - 선택 필드 처리 (birth_time, region)
  - 프로필 업데이트
  - 인증 없이 접근 시 401 에러

- [ ] **데이터 검증**
  - 날짜 형식 검증 (YYYY-MM-DD)
  - 시간 형식 검증 (HH:mm)
  - 성별 값 검증 (M/F/X)

### 3.3 AI 분석 생성
- [ ] **Job 생성**
  - 프로필 기반 Job 생성
  - Job ID 반환
  - 상태: queued

- [ ] **Job 상태 조회**
  - queued → running → done 전환
  - 진행률 업데이트 (0 → 100)
  - 완료 시 result_ref 반환

- [ ] **Life Profile 생성**
  - 분석 완료 후 자동 생성
  - Energy Type, 강점, 패턴 포함
  - 버전 정보 포함

### 3.4 데일리 가이드
- [ ] **가이드 조회**
  - 오늘 날짜 기본 조회
  - 특정 날짜 조회 (date 파라미터)
  - phase_tag, energy_index 포함
  - do/avoid 리스트 포함
  - relationships 텍스트 포함

- [ ] **에러 처리**
  - Life Profile 없을 시 404 에러
  - 인증 없이 접근 시 401 에러

### 3.5 UI/UX
- [ ] **로딩 상태**
  - 분석 생성 중 로딩 애니메이션
  - API 호출 중 스켈레톤 UI
  - 에러 상태 표시

- [ ] **반응형 디자인**
  - 모바일 (360px+)
  - 태블릿 (768px+)
  - 데스크탑 (1200px+)

- [ ] **접근성**
  - 키보드 네비게이션
  - 스크린 리더 호환성
  - ARIA 레이블

---

## 4. 성능 테스트

### 4.1 API 응답 시간
- [ ] OAuth 콜백: < 500ms
- [ ] 프로필 저장: < 300ms
- [ ] AI 분석 생성 (Job 생성): < 200ms
- [ ] Job 상태 조회: < 100ms
- [ ] Life Profile 조회: < 200ms
- [ ] Daily Guide 조회: < 300ms

### 4.2 프론트엔드 성능
- [ ] 초기 로드 시간: < 2초
- [ ] 페이지 전환: < 500ms
- [ ] 이미지/차트 렌더링: < 1초
- [ ] Job polling 간격: 1초 (과도한 요청 방지)

### 4.3 동시성 테스트
- [ ] 동시 로그인 10명
- [ ] 동시 분석 생성 5건
- [ ] 동시 가이드 조회 20건

---

## 5. 보안 테스트

### 5.1 인증/인가
- [ ] 인증 토큰 없이 API 접근 시 401 에러
- [ ] 만료된 토큰으로 접근 시 401 에러
- [ ] 잘못된 토큰 형식 시 401 에러
- [ ] refresh_token httpOnly cookie 설정
- [ ] CSRF 방지 (state 파라미터)

### 5.2 데이터 검증
- [ ] SQL Injection 방지 (JSON 파일 기반이므로 해당 없음)
- [ ] XSS 방지 (입력 데이터 sanitization)
- [ ] 입력 길이 제한
- [ ] 날짜/시간 형식 검증

### 5.3 개인정보 보호
- [ ] 민감 정보 로깅 제외
- [ ] 토큰 로컬스토리지 저장 (보안 고려)
- [ ] 프로필 데이터 암호화 (향후 DB 연동 시)

---

## 6. 에러 처리 테스트

### 6.1 네트워크 에러
- [ ] API 호출 실패 시 재시도 로직
- [ ] 타임아웃 처리
- [ ] 오프라인 상태 처리

### 6.2 서버 에러
- [ ] 500 에러 처리
- [ ] 503 에러 (서비스 점검) 처리
- [ ] 에러 메시지 사용자 친화적 표시

### 6.3 비즈니스 로직 에러
- [ ] 프로필 없이 분석 생성 시도
- [ ] 분석 없이 가이드 조회 시도
- [ ] 중복 프로필 저장

---

## 7. 브라우저 호환성 테스트

### 7.1 데스크탑 브라우저
- [ ] Chrome (최신)
- [ ] Firefox (최신)
- [ ] Safari (최신)
- [ ] Edge (최신)

### 7.2 모바일 브라우저
- [ ] Chrome Mobile
- [ ] Safari Mobile
- [ ] Samsung Internet

---

## 8. 테스트 실행 계획

### 8.1 테스트 단계

#### Phase 1: 개발 환경 테스트 (로컬)
- 단위 테스트 실행
- 통합 테스트 실행
- E2E 테스트 실행
- **목표**: 모든 테스트 케이스 통과

#### Phase 2: 스테이징 환경 테스트
- 전체 플로우 테스트
- 성능 테스트
- 보안 테스트
- **목표**: 프로덕션 배포 준비 완료

#### Phase 3: 프로덕션 배포 후 테스트
- 모니터링 확인
- 실제 사용자 플로우 확인
- 에러 로그 확인
- **목표**: 안정적 서비스 운영

### 8.2 테스트 도구

#### 백엔드
- **API 테스트**: Postman / Insomnia
- **단위 테스트**: Jest / Mocha
- **통합 테스트**: Supertest

#### 프론트엔드
- **단위 테스트**: Vitest / Jest
- **컴포넌트 테스트**: React Testing Library
- **E2E 테스트**: Playwright / Cypress

#### 성능 테스트
- **API**: k6 / Artillery
- **프론트엔드**: Lighthouse / WebPageTest

---

## 9. 테스트 체크리스트

### 9.1 필수 테스트 (Must Have)
- [x] OAuth 로그인 플로우
- [x] 프로필 저장
- [x] AI 분석 생성 및 완료
- [x] Life Profile 조회
- [x] Daily Guide 조회
- [x] Home 페이지 렌더링
- [x] 토큰 갱신
- [x] 에러 처리

### 9.2 권장 테스트 (Should Have)
- [ ] 성능 테스트
- [ ] 보안 테스트
- [ ] 브라우저 호환성
- [ ] 접근성 테스트

### 9.3 선택 테스트 (Nice to Have)
- [ ] 부하 테스트
- [ ] 스트레스 테스트
- [ ] 장애 복구 테스트

---

## 10. 테스트 결과 문서화

### 10.1 테스트 결과 보고서
- 테스트 실행 일자
- 테스트 환경 정보
- 통과/실패 테스트 케이스
- 발견된 버그 목록
- 성능 지표
- 보안 이슈

### 10.2 버그 추적
- 버그 ID
- 심각도 (Critical / High / Medium / Low)
- 재현 단계
- 예상 수정 일정
- 수정 완료 여부

---

## 11. 테스트 실행 가이드

### 11.1 로컬 환경 설정
```bash
# 백엔드 실행
cd backend
npm install
npm run dev

# 프론트엔드 실행
cd frontend
npm install
npm run dev
```

### 11.2 수동 테스트 시나리오

#### 시나리오 1: 신규 사용자 가입
1. 브라우저에서 `http://localhost:5173/login` 접속
2. "카카오로 시작하기" 버튼 클릭
3. `/onboarding` 페이지로 이동 확인
4. 프로필 정보 입력 후 제출
5. 분석 생성 로딩 화면 확인
6. 분석 완료 후 Home 페이지 확인

#### 시나리오 2: 데일리 가이드 조회
1. 로그인 상태에서 `/daily-guide` 접속
2. 오늘 가이드 자동 로드 확인
3. 날짜 변경하여 다른 날짜 가이드 조회

### 11.3 자동화 테스트 실행
```bash
# 프론트엔드 테스트
cd frontend
npm run test

# E2E 테스트
npm run test:e2e
```

---

## 12. KPI 측정

### 12.1 기능별 성공률
- OAuth 로그인 성공률: 목표 95%+
- 프로필 저장 성공률: 목표 98%+
- AI 분석 완료율: 목표 90%+
- 가이드 조회 성공률: 목표 99%+

### 12.2 사용자 경험 지표
- 가입 → 분석 완료 시간: 목표 3분 이내
- 첫 가이드 조회 시간: 목표 5초 이내
- 페이지 로드 시간: 목표 2초 이내

---

## 다음 단계

STEP 1 테스트 완료 후:
1. 테스트 결과 검토
2. 발견된 버그 수정
3. STEP 2 개발 시작 (기록 기능, 사이클 차트 등)

---

**작성일**: 2026-01-23  
**버전**: 1.0  
**작성자**: 개발팀
